{"ast":null,"code":"import ContextNode from '../core/ContextNode.js';\nimport { float, vec3, add, temp } from '../shadernode/ShaderNodeBaseElements.js';\nclass LightingContextNode extends ContextNode {\n  constructor(node) {\n    let lightingModelNode = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n    super(node);\n    this.lightingModelNode = lightingModelNode;\n  }\n  getNodeType( /*builder*/\n  ) {\n    return 'vec3';\n  }\n  construct(builder) {\n    const {\n      lightingModelNode\n    } = this;\n    const context = this.context = {}; // reset context\n    const properties = builder.getNodeProperties(this);\n    const directDiffuse = temp(vec3()),\n      directSpecular = temp(vec3()),\n      indirectDiffuse = temp(vec3()),\n      indirectSpecular = temp(vec3()),\n      total = add(directDiffuse, directSpecular, indirectDiffuse, indirectSpecular);\n    const reflectedLight = {\n      directDiffuse,\n      directSpecular,\n      indirectDiffuse,\n      indirectSpecular,\n      total\n    };\n    const lighting = {\n      radiance: temp(vec3()),\n      irradiance: temp(vec3()),\n      iblIrradiance: temp(vec3()),\n      ambientOcclusion: temp(float(1))\n    };\n    Object.assign(properties, reflectedLight, lighting);\n    Object.assign(context, lighting);\n    context.reflectedLight = reflectedLight;\n    context.lightingModelNode = lightingModelNode || context.lightingModelNode;\n    if (lightingModelNode?.indirectDiffuse) lightingModelNode.indirectDiffuse.call(context);\n    if (lightingModelNode?.indirectSpecular) lightingModelNode.indirectSpecular.call(context);\n    if (lightingModelNode?.ambientOcclusion) lightingModelNode.ambientOcclusion.call(context);\n    return super.construct(builder);\n  }\n  generate(builder) {\n    const {\n      context\n    } = this;\n    const type = this.getNodeType(builder);\n    super.generate(builder, type);\n    return context.reflectedLight.total.build(builder, type);\n  }\n}\nexport default LightingContextNode;","map":{"version":3,"names":["ContextNode","float","vec3","add","temp","LightingContextNode","constructor","node","lightingModelNode","getNodeType","construct","builder","context","properties","getNodeProperties","directDiffuse","directSpecular","indirectDiffuse","indirectSpecular","total","reflectedLight","lighting","radiance","irradiance","iblIrradiance","ambientOcclusion","Object","assign","call","generate","type","build"],"sources":["C:/Users/dro1l/source/repos/StaffWork/staffwork.client/node_modules/three/examples/jsm/nodes/lighting/LightingContextNode.js"],"sourcesContent":["import ContextNode from '../core/ContextNode.js';\nimport { float, vec3, add, temp } from '../shadernode/ShaderNodeBaseElements.js';\n\nclass LightingContextNode extends ContextNode {\n\n\tconstructor( node, lightingModelNode = null ) {\n\n\t\tsuper( node );\n\n\t\tthis.lightingModelNode = lightingModelNode;\n\n\t}\n\n\tgetNodeType( /*builder*/ ) {\n\n\t\treturn 'vec3';\n\n\t}\n\n\tconstruct( builder ) {\n\n\t\tconst { lightingModelNode } = this;\n\n\t\tconst context = this.context = {}; // reset context\n\t\tconst properties = builder.getNodeProperties( this );\n\n\t\tconst directDiffuse = temp( vec3() ),\n\t\t\tdirectSpecular = temp( vec3() ),\n\t\t\tindirectDiffuse = temp( vec3() ),\n\t\t\tindirectSpecular = temp( vec3() ),\n\t\t\ttotal = add( directDiffuse, directSpecular, indirectDiffuse, indirectSpecular );\n\n\t\tconst reflectedLight = {\n\t\t\tdirectDiffuse,\n\t\t\tdirectSpecular,\n\t\t\tindirectDiffuse,\n\t\t\tindirectSpecular,\n\t\t\ttotal\n\t\t};\n\n\t\tconst lighting = {\n\t\t\tradiance: temp( vec3() ),\n\t\t\tirradiance: temp( vec3() ),\n\t\t\tiblIrradiance: temp( vec3() ),\n\t\t\tambientOcclusion: temp( float( 1 ) )\n\t\t};\n\n\t\tObject.assign( properties, reflectedLight, lighting );\n\t\tObject.assign( context, lighting );\n\n\t\tcontext.reflectedLight = reflectedLight;\n\t\tcontext.lightingModelNode = lightingModelNode || context.lightingModelNode;\n\n\t\tif ( lightingModelNode?.indirectDiffuse ) lightingModelNode.indirectDiffuse.call( context );\n\t\tif ( lightingModelNode?.indirectSpecular ) lightingModelNode.indirectSpecular.call( context );\n\t\tif ( lightingModelNode?.ambientOcclusion ) lightingModelNode.ambientOcclusion.call( context );\n\n\t\treturn super.construct( builder );\n\n\t}\n\n\tgenerate( builder ) {\n\n\t\tconst { context } = this;\n\t\tconst type = this.getNodeType( builder );\n\n\t\tsuper.generate( builder, type );\n\n\t\treturn context.reflectedLight.total.build( builder, type );\n\n\t}\n\n}\n\nexport default LightingContextNode;\n"],"mappings":"AAAA,OAAOA,WAAW,MAAM,wBAAwB;AAChD,SAASC,KAAK,EAAEC,IAAI,EAAEC,GAAG,EAAEC,IAAI,QAAQ,yCAAyC;AAEhF,MAAMC,mBAAmB,SAASL,WAAW,CAAC;EAE7CM,WAAW,CAAEC,IAAI,EAA6B;IAAA,IAA3BC,iBAAiB,uEAAG,IAAI;IAE1C,KAAK,CAAED,IAAI,CAAE;IAEb,IAAI,CAACC,iBAAiB,GAAGA,iBAAiB;EAE3C;EAEAC,WAAW,EAAE;EAAA,EAAc;IAE1B,OAAO,MAAM;EAEd;EAEAC,SAAS,CAAEC,OAAO,EAAG;IAEpB,MAAM;MAAEH;IAAkB,CAAC,GAAG,IAAI;IAElC,MAAMI,OAAO,GAAG,IAAI,CAACA,OAAO,GAAG,CAAC,CAAC,CAAC,CAAC;IACnC,MAAMC,UAAU,GAAGF,OAAO,CAACG,iBAAiB,CAAE,IAAI,CAAE;IAEpD,MAAMC,aAAa,GAAGX,IAAI,CAAEF,IAAI,EAAE,CAAE;MACnCc,cAAc,GAAGZ,IAAI,CAAEF,IAAI,EAAE,CAAE;MAC/Be,eAAe,GAAGb,IAAI,CAAEF,IAAI,EAAE,CAAE;MAChCgB,gBAAgB,GAAGd,IAAI,CAAEF,IAAI,EAAE,CAAE;MACjCiB,KAAK,GAAGhB,GAAG,CAAEY,aAAa,EAAEC,cAAc,EAAEC,eAAe,EAAEC,gBAAgB,CAAE;IAEhF,MAAME,cAAc,GAAG;MACtBL,aAAa;MACbC,cAAc;MACdC,eAAe;MACfC,gBAAgB;MAChBC;IACD,CAAC;IAED,MAAME,QAAQ,GAAG;MAChBC,QAAQ,EAAElB,IAAI,CAAEF,IAAI,EAAE,CAAE;MACxBqB,UAAU,EAAEnB,IAAI,CAAEF,IAAI,EAAE,CAAE;MAC1BsB,aAAa,EAAEpB,IAAI,CAAEF,IAAI,EAAE,CAAE;MAC7BuB,gBAAgB,EAAErB,IAAI,CAAEH,KAAK,CAAE,CAAC,CAAE;IACnC,CAAC;IAEDyB,MAAM,CAACC,MAAM,CAAEd,UAAU,EAAEO,cAAc,EAAEC,QAAQ,CAAE;IACrDK,MAAM,CAACC,MAAM,CAAEf,OAAO,EAAES,QAAQ,CAAE;IAElCT,OAAO,CAACQ,cAAc,GAAGA,cAAc;IACvCR,OAAO,CAACJ,iBAAiB,GAAGA,iBAAiB,IAAII,OAAO,CAACJ,iBAAiB;IAE1E,IAAKA,iBAAiB,EAAES,eAAe,EAAGT,iBAAiB,CAACS,eAAe,CAACW,IAAI,CAAEhB,OAAO,CAAE;IAC3F,IAAKJ,iBAAiB,EAAEU,gBAAgB,EAAGV,iBAAiB,CAACU,gBAAgB,CAACU,IAAI,CAAEhB,OAAO,CAAE;IAC7F,IAAKJ,iBAAiB,EAAEiB,gBAAgB,EAAGjB,iBAAiB,CAACiB,gBAAgB,CAACG,IAAI,CAAEhB,OAAO,CAAE;IAE7F,OAAO,KAAK,CAACF,SAAS,CAAEC,OAAO,CAAE;EAElC;EAEAkB,QAAQ,CAAElB,OAAO,EAAG;IAEnB,MAAM;MAAEC;IAAQ,CAAC,GAAG,IAAI;IACxB,MAAMkB,IAAI,GAAG,IAAI,CAACrB,WAAW,CAAEE,OAAO,CAAE;IAExC,KAAK,CAACkB,QAAQ,CAAElB,OAAO,EAAEmB,IAAI,CAAE;IAE/B,OAAOlB,OAAO,CAACQ,cAAc,CAACD,KAAK,CAACY,KAAK,CAAEpB,OAAO,EAAEmB,IAAI,CAAE;EAE3D;AAED;AAEA,eAAezB,mBAAmB"},"metadata":{},"sourceType":"module","externalDependencies":[]}
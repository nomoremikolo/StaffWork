{"ast":null,"code":"import Node from '../core/Node.js';\nimport { vec3, mat3, mul, assign, buffer, element, dot, div, temp, instanceIndex, positionLocal, normalLocal } from '../shadernode/ShaderNodeBaseElements.js';\nclass InstanceNode extends Node {\n  constructor(instanceMesh) {\n    super('void');\n    this.instanceMesh = instanceMesh;\n\n    //\n\n    const instanceBufferNode = buffer(instanceMesh.instanceMatrix.array, 'mat4', instanceMesh.count);\n    this.instanceMatrixNode = temp(element(instanceBufferNode, instanceIndex)); // @TODO: a possible caching issue here?\n  }\n\n  generate(builder) {\n    const {\n      instanceMatrixNode\n    } = this;\n\n    // POSITION\n\n    const instancePosition = mul(instanceMatrixNode, positionLocal).xyz;\n\n    // NORMAL\n\n    const m = mat3(instanceMatrixNode[0].xyz, instanceMatrixNode[1].xyz, instanceMatrixNode[2].xyz);\n    const transformedNormal = div(normalLocal, vec3(dot(m[0], m[0]), dot(m[1], m[1]), dot(m[2], m[2])));\n    const instanceNormal = mul(m, transformedNormal).xyz;\n\n    // ASSIGNS\n\n    assign(positionLocal, instancePosition).build(builder);\n    assign(normalLocal, instanceNormal).build(builder);\n  }\n}\nexport default InstanceNode;","map":{"version":3,"names":["Node","vec3","mat3","mul","assign","buffer","element","dot","div","temp","instanceIndex","positionLocal","normalLocal","InstanceNode","constructor","instanceMesh","instanceBufferNode","instanceMatrix","array","count","instanceMatrixNode","generate","builder","instancePosition","xyz","m","transformedNormal","instanceNormal","build"],"sources":["C:/Users/dro1l/source/repos/StaffWork/staffwork.client/node_modules/three/examples/jsm/nodes/accessors/InstanceNode.js"],"sourcesContent":["import Node from '../core/Node.js';\nimport {\n\tvec3,\n\tmat3,\n\tmul,\n\tassign,\n\tbuffer,\n\telement,\n\tdot,\n\tdiv,\n\ttemp,\n\tinstanceIndex,\n\tpositionLocal,\n\tnormalLocal\n} from '../shadernode/ShaderNodeBaseElements.js';\n\nclass InstanceNode extends Node {\n\n\tconstructor( instanceMesh ) {\n\n\t\tsuper( 'void' );\n\n\t\tthis.instanceMesh = instanceMesh;\n\n\t\t//\n\n\t\tconst instanceBufferNode = buffer( instanceMesh.instanceMatrix.array, 'mat4', instanceMesh.count );\n\n\t\tthis.instanceMatrixNode = temp( element( instanceBufferNode, instanceIndex ) ); // @TODO: a possible caching issue here?\n\n\t}\n\n\tgenerate( builder ) {\n\n\t\tconst { instanceMatrixNode } = this;\n\n\t\t// POSITION\n\n\t\tconst instancePosition = mul( instanceMatrixNode, positionLocal ).xyz;\n\n\t\t// NORMAL\n\n\t\tconst m = mat3( instanceMatrixNode[ 0 ].xyz, instanceMatrixNode[ 1 ].xyz, instanceMatrixNode[ 2 ].xyz );\n\n\t\tconst transformedNormal = div( normalLocal, vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) ) );\n\n\t\tconst instanceNormal = mul( m, transformedNormal ).xyz;\n\n\t\t// ASSIGNS\n\n\t\tassign( positionLocal, instancePosition ).build( builder );\n\t\tassign( normalLocal, instanceNormal ).build( builder );\n\n\t}\n\n}\n\nexport default InstanceNode;\n"],"mappings":"AAAA,OAAOA,IAAI,MAAM,iBAAiB;AAClC,SACCC,IAAI,EACJC,IAAI,EACJC,GAAG,EACHC,MAAM,EACNC,MAAM,EACNC,OAAO,EACPC,GAAG,EACHC,GAAG,EACHC,IAAI,EACJC,aAAa,EACbC,aAAa,EACbC,WAAW,QACL,yCAAyC;AAEhD,MAAMC,YAAY,SAASb,IAAI,CAAC;EAE/Bc,WAAW,CAAEC,YAAY,EAAG;IAE3B,KAAK,CAAE,MAAM,CAAE;IAEf,IAAI,CAACA,YAAY,GAAGA,YAAY;;IAEhC;;IAEA,MAAMC,kBAAkB,GAAGX,MAAM,CAAEU,YAAY,CAACE,cAAc,CAACC,KAAK,EAAE,MAAM,EAAEH,YAAY,CAACI,KAAK,CAAE;IAElG,IAAI,CAACC,kBAAkB,GAAGX,IAAI,CAAEH,OAAO,CAAEU,kBAAkB,EAAEN,aAAa,CAAE,CAAE,CAAC,CAAC;EAEjF;;EAEAW,QAAQ,CAAEC,OAAO,EAAG;IAEnB,MAAM;MAAEF;IAAmB,CAAC,GAAG,IAAI;;IAEnC;;IAEA,MAAMG,gBAAgB,GAAGpB,GAAG,CAAEiB,kBAAkB,EAAET,aAAa,CAAE,CAACa,GAAG;;IAErE;;IAEA,MAAMC,CAAC,GAAGvB,IAAI,CAAEkB,kBAAkB,CAAE,CAAC,CAAE,CAACI,GAAG,EAAEJ,kBAAkB,CAAE,CAAC,CAAE,CAACI,GAAG,EAAEJ,kBAAkB,CAAE,CAAC,CAAE,CAACI,GAAG,CAAE;IAEvG,MAAME,iBAAiB,GAAGlB,GAAG,CAAEI,WAAW,EAAEX,IAAI,CAAEM,GAAG,CAAEkB,CAAC,CAAE,CAAC,CAAE,EAAEA,CAAC,CAAE,CAAC,CAAE,CAAE,EAAElB,GAAG,CAAEkB,CAAC,CAAE,CAAC,CAAE,EAAEA,CAAC,CAAE,CAAC,CAAE,CAAE,EAAElB,GAAG,CAAEkB,CAAC,CAAE,CAAC,CAAE,EAAEA,CAAC,CAAE,CAAC,CAAE,CAAE,CAAE,CAAE;IAEzH,MAAME,cAAc,GAAGxB,GAAG,CAAEsB,CAAC,EAAEC,iBAAiB,CAAE,CAACF,GAAG;;IAEtD;;IAEApB,MAAM,CAAEO,aAAa,EAAEY,gBAAgB,CAAE,CAACK,KAAK,CAAEN,OAAO,CAAE;IAC1DlB,MAAM,CAAEQ,WAAW,EAAEe,cAAc,CAAE,CAACC,KAAK,CAAEN,OAAO,CAAE;EAEvD;AAED;AAEA,eAAeT,YAAY"},"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"import _slicedToArray from\"C:/Users/dro1l/source/repos/StaffWork/staffwork.client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useState}from'react';import{useAppDispatch,useAppSelector}from\"../../hooks/redux\";import ReactDOM from\"react-dom\";import{ButtonGroup,Modal}from\"react-bootstrap\";import{DashCircle,Heartbreak,PlusCircle,XLg}from\"react-bootstrap-icons\";import{changeBasketWareCount,clearBasket,confirmOrder,fetch_cart_wares,removeFromBasket}from\"../../redux/action_creators/ware_action_creator\";import{Link}from\"react-router-dom\";import{ImagesEndpoint}from\"../../global_variables\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var CartModal=function CartModal(_ref){var show=_ref.show,closeHandler=_ref.closeHandler;var dispatch=useAppDispatch();var _useAppSelector=useAppSelector(function(state){return state.authorizationReducer;}),isAuthorized=_useAppSelector.isAuthorized;var _useAppSelector2=useAppSelector(function(state){return state.wareReducer;}),cartWares=_useAppSelector2.cartWares;var _useState=useState(0),_useState2=_slicedToArray(_useState,2),sum=_useState2[0],setSum=_useState2[1];useEffect(function(){dispatch(fetch_cart_wares());var inter=setInterval(function(){if(cartWares.length>0)dispatch(fetch_cart_wares());},600);return function(){clearInterval(inter);};},[]);useEffect(function(){dispatch(fetch_cart_wares());},[show]);useEffect(function(){var summ=0;cartWares.forEach(function(item){summ+=item.price*item.count;});setSum(summ);},[cartWares]);if(!show)return null;return/*#__PURE__*/ReactDOM.createPortal(/*#__PURE__*/_jsxs(Modal,{show:show,onHide:closeHandler,children:[/*#__PURE__*/_jsx(Modal.Header,{closeButton:true,children:/*#__PURE__*/_jsx(Modal.Title,{children:\"Cart\"})}),/*#__PURE__*/_jsxs(Modal.Body,{children:[!isAuthorized?/*#__PURE__*/_jsxs(\"h3\",{className:'text-center my-4',children:[\"\\u0412\\u0438 \\u043D\\u0435 \\u0430\\u0432\\u0442\\u043E\\u0440\\u0438\\u0437\\u043E\\u0432\\u0430\\u043D\\u0456 \",/*#__PURE__*/_jsx(Heartbreak,{className:'mb-1'})]}):/*#__PURE__*/_jsx(_Fragment,{}),!isAuthorized?/*#__PURE__*/_jsxs(\"h3\",{className:'text-center my-4',children:[\"\\u0412\\u0438 \\u043D\\u0435 \\u0430\\u0432\\u0442\\u043E\\u0440\\u0438\\u0437\\u043E\\u0432\\u0430\\u043D\\u0456 \",/*#__PURE__*/_jsx(Heartbreak,{className:'mb-1'})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[cartWares.length>0?cartWares.map(function(item){return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"card w-75 mx-auto mb-3\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){dispatch(removeFromBasket(item.id));dispatch(fetch_cart_wares());},className:\"p-0 btn btn-secondary position-absolute top-0 end-0 mt-3 me-3\",children:/*#__PURE__*/_jsx(XLg,{height:20,width:20})}),/*#__PURE__*/_jsx(\"img\",{style:{\"width\":\"80%\",\"margin\":\"auto\"},src:\"\".concat(ImagesEndpoint,\"/Get/\").concat(item.thumbnail),className:\"card-img-top\",alt:\"...\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"card-body\",children:[/*#__PURE__*/_jsx(\"h5\",{className:\"card-title\",children:item.name}),/*#__PURE__*/_jsx(\"p\",{className:\"card-text\",children:item.sizes}),/*#__PURE__*/_jsxs(\"p\",{className:\"card-text\",children:[item.price,\" \\u0433\\u0440\\u043D.\"]}),item.isDiscount?/*#__PURE__*/_jsx(\"p\",{className:\"card-text\",children:/*#__PURE__*/_jsxs(\"del\",{children:[item.oldPrice,\" \\u0433\\u0440\\u043D.\"]})}):/*#__PURE__*/_jsx(_Fragment,{}),/*#__PURE__*/_jsx(Link,{onClick:closeHandler,to:\"/Wares/\".concat(item.id),className:\"btn btn-primary\",children:\"More\"}),/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(e){var _e$currentTarget$next;var count=Number((_e$currentTarget$next=e.currentTarget.nextSibling)===null||_e$currentTarget$next===void 0?void 0:_e$currentTarget$next.innerHTML);if(count<item.countInStorage){dispatch(changeBasketWareCount(item.id,Number(e.currentTarget.nextSibling.innerHTML)+1));e.currentTarget.nextSibling.innerHTML=Number(e.currentTarget.nextSibling.innerHTML)+1;}},className:'btn btn-secondary mb-1 ms-3 me-3 p-0',children:/*#__PURE__*/_jsx(PlusCircle,{height:20,width:20})}),/*#__PURE__*/_jsx(\"p\",{className:'d-inline',children:item.count}),/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(e){var _e$currentTarget$prev;var count=Number((_e$currentTarget$prev=e.currentTarget.previousElementSibling)===null||_e$currentTarget$prev===void 0?void 0:_e$currentTarget$prev.innerHTML);if(count>1){dispatch(changeBasketWareCount(item.id,count-1));e.currentTarget.previousElementSibling.innerHTML=count-1;}},className:'btn btn-secondary mb-1 ms-3 p-0',children:/*#__PURE__*/_jsx(DashCircle,{height:20,width:20})})]})]})});}):/*#__PURE__*/_jsx(\"p\",{children:\"Oops, it's empty\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-footer\",children:[/*#__PURE__*/_jsxs(\"p\",{className:'my-3 d-inline p-2',children:[\"Order for the amount:\",sum,\" \\u0433\\u0440\\u043D.\"]}),/*#__PURE__*/_jsxs(ButtonGroup,{\"aria-label\":\"Basic example\",children:[/*#__PURE__*/_jsx(\"button\",{disabled:cartWares.length<1,onClick:function onClick(){if(cartWares.length>0)dispatch(clearBasket(function(){return dispatch(fetch_cart_wares());}));},type:\"button\",className:\"btn btn-danger\",children:\"Clear basket\"}),/*#__PURE__*/_jsx(\"button\",{disabled:cartWares.length<1,onClick:function onClick(){if(cartWares.length>0)dispatch(confirmOrder(function(){return dispatch(fetch_cart_wares());}));},type:\"button\",className:\"btn btn-primary\",children:\"Confirm order\"})]})]})]})]})]}),document.getElementById('portal'));};export default CartModal;","map":{"version":3,"names":["React","useEffect","useState","useAppDispatch","useAppSelector","ReactDOM","ButtonGroup","Modal","DashCircle","Heartbreak","PlusCircle","XLg","changeBasketWareCount","clearBasket","confirmOrder","fetch_cart_wares","removeFromBasket","Link","ImagesEndpoint","CartModal","show","closeHandler","dispatch","state","authorizationReducer","isAuthorized","wareReducer","cartWares","sum","setSum","inter","setInterval","length","clearInterval","summ","forEach","item","price","count","createPortal","map","id","thumbnail","name","sizes","isDiscount","oldPrice","e","Number","currentTarget","nextSibling","innerHTML","countInStorage","previousElementSibling","document","getElementById"],"sources":["C:/Users/dro1l/source/repos/StaffWork/staffwork.client/src/pages/Layout/CartModal.tsx"],"sourcesContent":["import React, {FC, useEffect, useState} from 'react';\r\nimport {useAppDispatch, useAppSelector} from \"../../hooks/redux\";\r\nimport ReactDOM from \"react-dom\";\r\nimport {Button, ButtonGroup, Modal} from \"react-bootstrap\";\r\nimport {Basket, DashCircle, Heartbreak, PlusCircle, XLg} from \"react-bootstrap-icons\";\r\nimport {\r\n    changeBasketWareCount, clearBasket, confirmOrder,\r\n    fetch_cart_wares,\r\n    removeFromBasket\r\n} from \"../../redux/action_creators/ware_action_creator\";\r\nimport {Link} from \"react-router-dom\";\r\nimport {ImagesEndpoint} from \"../../global_variables\";\r\n\r\ninterface ICardModal {\r\n    show: boolean,\r\n    closeHandler: () => void,\r\n}\r\n\r\nconst CartModal: FC<ICardModal> = ({show, closeHandler}) => {\r\n    const dispatch = useAppDispatch()\r\n    const {isAuthorized} = useAppSelector(state => state.authorizationReducer)\r\n    const {cartWares} = useAppSelector(state => state.wareReducer)\r\n    const [sum, setSum] = useState(0)\r\n    useEffect(() => {\r\n        dispatch(fetch_cart_wares())\r\n        let inter = setInterval(() => {\r\n            if (cartWares.length > 0) dispatch(fetch_cart_wares())\r\n        }, 600)\r\n        return function (){\r\n            clearInterval(inter)\r\n        }\r\n    }, [])\r\n    useEffect(() => {\r\n        dispatch(fetch_cart_wares())\r\n    }, [show])\r\n    useEffect(() => {\r\n        let summ = 0;\r\n        cartWares.forEach((item) => {\r\n            summ += (item.price * item.count);\r\n        })\r\n        setSum(summ)\r\n    }, [cartWares])\r\n    if (!show) return null\r\n    return ReactDOM.createPortal(\r\n        <Modal show={show} onHide={closeHandler}>\r\n            <Modal.Header closeButton>\r\n                <Modal.Title>Cart</Modal.Title>\r\n            </Modal.Header>\r\n            <Modal.Body>\r\n                {!isAuthorized ?\r\n                    <h3 className={'text-center my-4'}>Ви не авторизовані <Heartbreak className={'mb-1'}/></h3> : <></>}\r\n                {!isAuthorized ?\r\n                    <h3 className={'text-center my-4'}>Ви не авторизовані <Heartbreak className={'mb-1'}/></h3> :\r\n                    <>\r\n                        {cartWares.length > 0 ?\r\n                            cartWares.map(item => (\r\n                                    <>\r\n                                        <div className=\"card w-75 mx-auto mb-3\">\r\n                                            <button onClick={() => {dispatch(removeFromBasket(item.id));dispatch(fetch_cart_wares())}} className={\"p-0 btn btn-secondary position-absolute top-0 end-0 mt-3 me-3\"}><XLg height={20} width={20}/></button>\r\n                                            <img style={{\"width\": \"80%\", \"margin\": \"auto\"}}\r\n                                                 src={`${ImagesEndpoint}/Get/${item.thumbnail}`}\r\n                                                 className=\"card-img-top\" alt=\"...\"/>\r\n                                            <div className=\"card-body\">\r\n                                                <h5 className=\"card-title\">{item.name}</h5>\r\n                                                <p className=\"card-text\">{item.sizes}</p>\r\n                                                <p className=\"card-text\">{item.price} грн.</p>\r\n                                                {item.isDiscount ? <p className=\"card-text\">\r\n                                                    <del>{item.oldPrice} грн.</del>\r\n                                                </p> : <></>\r\n                                                }\r\n                                                <Link onClick={closeHandler} to={`/Wares/${item.id!}`}\r\n                                                      className=\"btn btn-primary\">More</Link>\r\n                                                <button onClick={(e: any) => {\r\n                                                    let count = Number(e.currentTarget.nextSibling?.innerHTML)\r\n                                                    if(count < item.countInStorage){\r\n                                                        dispatch(changeBasketWareCount(item.id, Number(e.currentTarget.nextSibling.innerHTML) + 1))\r\n                                                        e.currentTarget.nextSibling.innerHTML = Number(e.currentTarget.nextSibling.innerHTML) + 1\r\n                                                    }\r\n                                                }\r\n                                                } className={'btn btn-secondary mb-1 ms-3 me-3 p-0'}><PlusCircle height={20} width={20}/></button>\r\n                                                <p className={'d-inline'}>{item.count}</p>\r\n                                                <button onClick={(e: any) => {\r\n                                                    let count = Number(e.currentTarget.previousElementSibling?.innerHTML)\r\n                                                    if(count > 1){\r\n                                                        dispatch(changeBasketWareCount(item.id, count - 1));\r\n                                                        e.currentTarget.previousElementSibling.innerHTML = count - 1\r\n                                                    }\r\n                                                }} className={'btn btn-secondary mb-1 ms-3 p-0'}><DashCircle height={20} width={20}/></button>\r\n                                            </div>\r\n                                        </div>\r\n                                    </>\r\n                                )\r\n                            )\r\n                            : <p>Oops, it's empty</p>}\r\n                        <div className=\"modal-footer\">\r\n                            <p className={'my-3 d-inline p-2'}>Order for the amount:{sum} грн.</p>\r\n                            <ButtonGroup aria-label=\"Basic example\">\r\n                                <button disabled={cartWares.length < 1} onClick={() => {\r\n                                    if(cartWares.length > 0)\r\n                                        dispatch(clearBasket(() => dispatch(fetch_cart_wares())))}\r\n                                } type=\"button\" className=\"btn btn-danger\">Clear basket</button>\r\n                                <button disabled={cartWares.length < 1} onClick={() => {\r\n                                    if(cartWares.length > 0)\r\n                                        dispatch(confirmOrder(() => dispatch(fetch_cart_wares())))}\r\n                                } type=\"button\" className=\"btn btn-primary\">Confirm order</button>\r\n                            </ButtonGroup>\r\n                        </div>\r\n                    </>\r\n                }\r\n            </Modal.Body>\r\n        </Modal>,\r\n        document.getElementById('portal') as HTMLElement\r\n    );\r\n};\r\n\r\nexport default CartModal;"],"mappings":"4IAAA,MAAOA,MAAK,EAAOC,SAAS,CAAEC,QAAQ,KAAO,OAAO,CACpD,OAAQC,cAAc,CAAEC,cAAc,KAAO,mBAAmB,CAChE,MAAOC,SAAQ,KAAM,WAAW,CAChC,OAAgBC,WAAW,CAAEC,KAAK,KAAO,iBAAiB,CAC1D,OAAgBC,UAAU,CAAEC,UAAU,CAAEC,UAAU,CAAEC,GAAG,KAAO,uBAAuB,CACrF,OACIC,qBAAqB,CAAEC,WAAW,CAAEC,YAAY,CAChDC,gBAAgB,CAChBC,gBAAgB,KACb,iDAAiD,CACxD,OAAQC,IAAI,KAAO,kBAAkB,CACrC,OAAQC,cAAc,KAAO,wBAAwB,CAAC,6IAOtD,GAAMC,UAAyB,CAAG,QAA5BA,UAAyB,MAA6B,IAAxBC,KAAI,MAAJA,IAAI,CAAEC,YAAY,MAAZA,YAAY,CAClD,GAAMC,SAAQ,CAAGnB,cAAc,EAAE,CACjC,oBAAuBC,cAAc,CAAC,SAAAmB,KAAK,QAAIA,MAAK,CAACC,oBAAoB,GAAC,CAAnEC,YAAY,iBAAZA,YAAY,CACnB,qBAAoBrB,cAAc,CAAC,SAAAmB,KAAK,QAAIA,MAAK,CAACG,WAAW,GAAC,CAAvDC,SAAS,kBAATA,SAAS,CAChB,cAAsBzB,QAAQ,CAAC,CAAC,CAAC,wCAA1B0B,GAAG,eAAEC,MAAM,eAClB5B,SAAS,CAAC,UAAM,CACZqB,QAAQ,CAACP,gBAAgB,EAAE,CAAC,CAC5B,GAAIe,MAAK,CAAGC,WAAW,CAAC,UAAM,CAC1B,GAAIJ,SAAS,CAACK,MAAM,CAAG,CAAC,CAAEV,QAAQ,CAACP,gBAAgB,EAAE,CAAC,CAC1D,CAAC,CAAE,GAAG,CAAC,CACP,MAAO,WAAW,CACdkB,aAAa,CAACH,KAAK,CAAC,CACxB,CAAC,CACL,CAAC,CAAE,EAAE,CAAC,CACN7B,SAAS,CAAC,UAAM,CACZqB,QAAQ,CAACP,gBAAgB,EAAE,CAAC,CAChC,CAAC,CAAE,CAACK,IAAI,CAAC,CAAC,CACVnB,SAAS,CAAC,UAAM,CACZ,GAAIiC,KAAI,CAAG,CAAC,CACZP,SAAS,CAACQ,OAAO,CAAC,SAACC,IAAI,CAAK,CACxBF,IAAI,EAAKE,IAAI,CAACC,KAAK,CAAGD,IAAI,CAACE,KAAM,CACrC,CAAC,CAAC,CACFT,MAAM,CAACK,IAAI,CAAC,CAChB,CAAC,CAAE,CAACP,SAAS,CAAC,CAAC,CACf,GAAI,CAACP,IAAI,CAAE,MAAO,KAAI,CACtB,mBAAOf,QAAQ,CAACkC,YAAY,cACxB,MAAC,KAAK,EAAC,IAAI,CAAEnB,IAAK,CAAC,MAAM,CAAEC,YAAa,wBACpC,KAAC,KAAK,CAAC,MAAM,EAAC,WAAW,4BACrB,KAAC,KAAK,CAAC,KAAK,mBAAmB,EACpB,cACf,MAAC,KAAK,CAAC,IAAI,YACN,CAACI,YAAY,cACV,YAAI,SAAS,CAAE,kBAAmB,8HAAoB,KAAC,UAAU,EAAC,SAAS,CAAE,MAAO,EAAE,GAAK,cAAG,kBAAK,CACtG,CAACA,YAAY,cACV,YAAI,SAAS,CAAE,kBAAmB,8HAAoB,KAAC,UAAU,EAAC,SAAS,CAAE,MAAO,EAAE,GAAK,cAC3F,2BACKE,SAAS,CAACK,MAAM,CAAG,CAAC,CACjBL,SAAS,CAACa,GAAG,CAAC,SAAAJ,IAAI,qBACV,sCACI,aAAK,SAAS,CAAC,wBAAwB,wBACnC,eAAQ,OAAO,CAAE,kBAAM,CAACd,QAAQ,CAACN,gBAAgB,CAACoB,IAAI,CAACK,EAAE,CAAC,CAAC,CAACnB,QAAQ,CAACP,gBAAgB,EAAE,CAAC,EAAE,CAAC,SAAS,CAAE,+DAAgE,uBAAC,KAAC,GAAG,EAAC,MAAM,CAAE,EAAG,CAAC,KAAK,CAAE,EAAG,EAAE,EAAS,cAC7M,YAAK,KAAK,CAAE,CAAC,OAAO,CAAE,KAAK,CAAE,QAAQ,CAAE,MAAM,CAAE,CAC1C,GAAG,WAAKG,cAAc,iBAAQkB,IAAI,CAACM,SAAS,CAAG,CAC/C,SAAS,CAAC,cAAc,CAAC,GAAG,CAAC,KAAK,EAAE,cACzC,aAAK,SAAS,CAAC,WAAW,wBACtB,WAAI,SAAS,CAAC,YAAY,UAAEN,IAAI,CAACO,IAAI,EAAM,cAC3C,UAAG,SAAS,CAAC,WAAW,UAAEP,IAAI,CAACQ,KAAK,EAAK,cACzC,WAAG,SAAS,CAAC,WAAW,WAAER,IAAI,CAACC,KAAK,0BAAU,CAC7CD,IAAI,CAACS,UAAU,cAAG,UAAG,SAAS,CAAC,WAAW,uBACvC,uBAAMT,IAAI,CAACU,QAAQ,0BAAY,EAC/B,cAAG,kBAAK,cAEZ,KAAC,IAAI,EAAC,OAAO,CAAEzB,YAAa,CAAC,EAAE,kBAAYe,IAAI,CAACK,EAAE,CAAI,CAChD,SAAS,CAAC,iBAAiB,kBAAY,cAC7C,eAAQ,OAAO,CAAE,iBAACM,CAAM,CAAK,2BACzB,GAAIT,MAAK,CAAGU,MAAM,wBAACD,CAAC,CAACE,aAAa,CAACC,WAAW,gDAA3B,sBAA6BC,SAAS,CAAC,CAC1D,GAAGb,KAAK,CAAGF,IAAI,CAACgB,cAAc,CAAC,CAC3B9B,QAAQ,CAACV,qBAAqB,CAACwB,IAAI,CAACK,EAAE,CAAEO,MAAM,CAACD,CAAC,CAACE,aAAa,CAACC,WAAW,CAACC,SAAS,CAAC,CAAG,CAAC,CAAC,CAAC,CAC3FJ,CAAC,CAACE,aAAa,CAACC,WAAW,CAACC,SAAS,CAAGH,MAAM,CAACD,CAAC,CAACE,aAAa,CAACC,WAAW,CAACC,SAAS,CAAC,CAAG,CAAC,CAC7F,CACJ,CACC,CAAC,SAAS,CAAE,sCAAuC,uBAAC,KAAC,UAAU,EAAC,MAAM,CAAE,EAAG,CAAC,KAAK,CAAE,EAAG,EAAE,EAAS,cAClG,UAAG,SAAS,CAAE,UAAW,UAAEf,IAAI,CAACE,KAAK,EAAK,cAC1C,eAAQ,OAAO,CAAE,iBAACS,CAAM,CAAK,2BACzB,GAAIT,MAAK,CAAGU,MAAM,wBAACD,CAAC,CAACE,aAAa,CAACI,sBAAsB,gDAAtC,sBAAwCF,SAAS,CAAC,CACrE,GAAGb,KAAK,CAAG,CAAC,CAAC,CACThB,QAAQ,CAACV,qBAAqB,CAACwB,IAAI,CAACK,EAAE,CAAEH,KAAK,CAAG,CAAC,CAAC,CAAC,CACnDS,CAAC,CAACE,aAAa,CAACI,sBAAsB,CAACF,SAAS,CAAGb,KAAK,CAAG,CAAC,CAChE,CACJ,CAAE,CAAC,SAAS,CAAE,iCAAkC,uBAAC,KAAC,UAAU,EAAC,MAAM,CAAE,EAAG,CAAC,KAAK,CAAE,EAAG,EAAE,EAAS,GAC5F,GACJ,EACP,EACN,CACJ,cACC,uCAAuB,cAC7B,aAAK,SAAS,CAAC,cAAc,wBACzB,WAAG,SAAS,CAAE,mBAAoB,mCAAuBV,GAAG,0BAAU,cACtE,MAAC,WAAW,EAAC,aAAW,eAAe,wBACnC,eAAQ,QAAQ,CAAED,SAAS,CAACK,MAAM,CAAG,CAAE,CAAC,OAAO,CAAE,kBAAM,CACnD,GAAGL,SAAS,CAACK,MAAM,CAAG,CAAC,CACnBV,QAAQ,CAACT,WAAW,CAAC,iBAAMS,SAAQ,CAACP,gBAAgB,EAAE,CAAC,GAAC,CAAC,EAChE,CAAC,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,gBAAgB,0BAAsB,cAChE,eAAQ,QAAQ,CAAEY,SAAS,CAACK,MAAM,CAAG,CAAE,CAAC,OAAO,CAAE,kBAAM,CACnD,GAAGL,SAAS,CAACK,MAAM,CAAG,CAAC,CACnBV,QAAQ,CAACR,YAAY,CAAC,iBAAMQ,SAAQ,CAACP,gBAAgB,EAAE,CAAC,GAAC,CAAC,EACjE,CAAC,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,iBAAiB,2BAAuB,GACxD,GACZ,GACP,GAEE,GACT,CACRuC,QAAQ,CAACC,cAAc,CAAC,QAAQ,CAAC,CACpC,CACL,CAAC,CAED,cAAepC,UAAS"},"metadata":{},"sourceType":"module","externalDependencies":[]}
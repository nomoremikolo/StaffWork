{"ast":null,"code":"import { CubeReflectionMapping, CubeRefractionMapping, EquirectangularReflectionMapping, EquirectangularRefractionMapping } from '../../constants.js';\nimport { WebGLCubeRenderTarget } from '../WebGLCubeRenderTarget.js';\nfunction WebGLCubeMaps(renderer) {\n  let cubemaps = new WeakMap();\n  function mapTextureMapping(texture, mapping) {\n    if (mapping === EquirectangularReflectionMapping) {\n      texture.mapping = CubeReflectionMapping;\n    } else if (mapping === EquirectangularRefractionMapping) {\n      texture.mapping = CubeRefractionMapping;\n    }\n    return texture;\n  }\n  function get(texture) {\n    if (texture && texture.isTexture && texture.isRenderTargetTexture === false) {\n      const mapping = texture.mapping;\n      if (mapping === EquirectangularReflectionMapping || mapping === EquirectangularRefractionMapping) {\n        if (cubemaps.has(texture)) {\n          const cubemap = cubemaps.get(texture).texture;\n          return mapTextureMapping(cubemap, texture.mapping);\n        } else {\n          const image = texture.image;\n          if (image && image.height > 0) {\n            const renderTarget = new WebGLCubeRenderTarget(image.height / 2);\n            renderTarget.fromEquirectangularTexture(renderer, texture);\n            cubemaps.set(texture, renderTarget);\n            texture.addEventListener('dispose', onTextureDispose);\n            return mapTextureMapping(renderTarget.texture, texture.mapping);\n          } else {\n            // image not yet ready. try the conversion next frame\n\n            return null;\n          }\n        }\n      }\n    }\n    return texture;\n  }\n  function onTextureDispose(event) {\n    const texture = event.target;\n    texture.removeEventListener('dispose', onTextureDispose);\n    const cubemap = cubemaps.get(texture);\n    if (cubemap !== undefined) {\n      cubemaps.delete(texture);\n      cubemap.dispose();\n    }\n  }\n  function dispose() {\n    cubemaps = new WeakMap();\n  }\n  return {\n    get: get,\n    dispose: dispose\n  };\n}\nexport { WebGLCubeMaps };","map":{"version":3,"names":["CubeReflectionMapping","CubeRefractionMapping","EquirectangularReflectionMapping","EquirectangularRefractionMapping","WebGLCubeRenderTarget","WebGLCubeMaps","renderer","cubemaps","WeakMap","mapTextureMapping","texture","mapping","get","isTexture","isRenderTargetTexture","has","cubemap","image","height","renderTarget","fromEquirectangularTexture","set","addEventListener","onTextureDispose","event","target","removeEventListener","undefined","delete","dispose"],"sources":["C:/Users/dro1l/source/repos/StaffWork/staffwork.client/node_modules/three/src/renderers/webgl/WebGLCubeMaps.js"],"sourcesContent":["import { CubeReflectionMapping, CubeRefractionMapping, EquirectangularReflectionMapping, EquirectangularRefractionMapping } from '../../constants.js';\nimport { WebGLCubeRenderTarget } from '../WebGLCubeRenderTarget.js';\n\nfunction WebGLCubeMaps( renderer ) {\n\n\tlet cubemaps = new WeakMap();\n\n\tfunction mapTextureMapping( texture, mapping ) {\n\n\t\tif ( mapping === EquirectangularReflectionMapping ) {\n\n\t\t\ttexture.mapping = CubeReflectionMapping;\n\n\t\t} else if ( mapping === EquirectangularRefractionMapping ) {\n\n\t\t\ttexture.mapping = CubeRefractionMapping;\n\n\t\t}\n\n\t\treturn texture;\n\n\t}\n\n\tfunction get( texture ) {\n\n\t\tif ( texture && texture.isTexture && texture.isRenderTargetTexture === false ) {\n\n\t\t\tconst mapping = texture.mapping;\n\n\t\t\tif ( mapping === EquirectangularReflectionMapping || mapping === EquirectangularRefractionMapping ) {\n\n\t\t\t\tif ( cubemaps.has( texture ) ) {\n\n\t\t\t\t\tconst cubemap = cubemaps.get( texture ).texture;\n\t\t\t\t\treturn mapTextureMapping( cubemap, texture.mapping );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconst image = texture.image;\n\n\t\t\t\t\tif ( image && image.height > 0 ) {\n\n\t\t\t\t\t\tconst renderTarget = new WebGLCubeRenderTarget( image.height / 2 );\n\t\t\t\t\t\trenderTarget.fromEquirectangularTexture( renderer, texture );\n\t\t\t\t\t\tcubemaps.set( texture, renderTarget );\n\n\t\t\t\t\t\ttexture.addEventListener( 'dispose', onTextureDispose );\n\n\t\t\t\t\t\treturn mapTextureMapping( renderTarget.texture, texture.mapping );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\t// image not yet ready. try the conversion next frame\n\n\t\t\t\t\t\treturn null;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn texture;\n\n\t}\n\n\tfunction onTextureDispose( event ) {\n\n\t\tconst texture = event.target;\n\n\t\ttexture.removeEventListener( 'dispose', onTextureDispose );\n\n\t\tconst cubemap = cubemaps.get( texture );\n\n\t\tif ( cubemap !== undefined ) {\n\n\t\t\tcubemaps.delete( texture );\n\t\t\tcubemap.dispose();\n\n\t\t}\n\n\t}\n\n\tfunction dispose() {\n\n\t\tcubemaps = new WeakMap();\n\n\t}\n\n\treturn {\n\t\tget: get,\n\t\tdispose: dispose\n\t};\n\n}\n\nexport { WebGLCubeMaps };\n"],"mappings":"AAAA,SAASA,qBAAqB,EAAEC,qBAAqB,EAAEC,gCAAgC,EAAEC,gCAAgC,QAAQ,oBAAoB;AACrJ,SAASC,qBAAqB,QAAQ,6BAA6B;AAEnE,SAASC,aAAa,CAAEC,QAAQ,EAAG;EAElC,IAAIC,QAAQ,GAAG,IAAIC,OAAO,EAAE;EAE5B,SAASC,iBAAiB,CAAEC,OAAO,EAAEC,OAAO,EAAG;IAE9C,IAAKA,OAAO,KAAKT,gCAAgC,EAAG;MAEnDQ,OAAO,CAACC,OAAO,GAAGX,qBAAqB;IAExC,CAAC,MAAM,IAAKW,OAAO,KAAKR,gCAAgC,EAAG;MAE1DO,OAAO,CAACC,OAAO,GAAGV,qBAAqB;IAExC;IAEA,OAAOS,OAAO;EAEf;EAEA,SAASE,GAAG,CAAEF,OAAO,EAAG;IAEvB,IAAKA,OAAO,IAAIA,OAAO,CAACG,SAAS,IAAIH,OAAO,CAACI,qBAAqB,KAAK,KAAK,EAAG;MAE9E,MAAMH,OAAO,GAAGD,OAAO,CAACC,OAAO;MAE/B,IAAKA,OAAO,KAAKT,gCAAgC,IAAIS,OAAO,KAAKR,gCAAgC,EAAG;QAEnG,IAAKI,QAAQ,CAACQ,GAAG,CAAEL,OAAO,CAAE,EAAG;UAE9B,MAAMM,OAAO,GAAGT,QAAQ,CAACK,GAAG,CAAEF,OAAO,CAAE,CAACA,OAAO;UAC/C,OAAOD,iBAAiB,CAAEO,OAAO,EAAEN,OAAO,CAACC,OAAO,CAAE;QAErD,CAAC,MAAM;UAEN,MAAMM,KAAK,GAAGP,OAAO,CAACO,KAAK;UAE3B,IAAKA,KAAK,IAAIA,KAAK,CAACC,MAAM,GAAG,CAAC,EAAG;YAEhC,MAAMC,YAAY,GAAG,IAAIf,qBAAqB,CAAEa,KAAK,CAACC,MAAM,GAAG,CAAC,CAAE;YAClEC,YAAY,CAACC,0BAA0B,CAAEd,QAAQ,EAAEI,OAAO,CAAE;YAC5DH,QAAQ,CAACc,GAAG,CAAEX,OAAO,EAAES,YAAY,CAAE;YAErCT,OAAO,CAACY,gBAAgB,CAAE,SAAS,EAAEC,gBAAgB,CAAE;YAEvD,OAAOd,iBAAiB,CAAEU,YAAY,CAACT,OAAO,EAAEA,OAAO,CAACC,OAAO,CAAE;UAElE,CAAC,MAAM;YAEN;;YAEA,OAAO,IAAI;UAEZ;QAED;MAED;IAED;IAEA,OAAOD,OAAO;EAEf;EAEA,SAASa,gBAAgB,CAAEC,KAAK,EAAG;IAElC,MAAMd,OAAO,GAAGc,KAAK,CAACC,MAAM;IAE5Bf,OAAO,CAACgB,mBAAmB,CAAE,SAAS,EAAEH,gBAAgB,CAAE;IAE1D,MAAMP,OAAO,GAAGT,QAAQ,CAACK,GAAG,CAAEF,OAAO,CAAE;IAEvC,IAAKM,OAAO,KAAKW,SAAS,EAAG;MAE5BpB,QAAQ,CAACqB,MAAM,CAAElB,OAAO,CAAE;MAC1BM,OAAO,CAACa,OAAO,EAAE;IAElB;EAED;EAEA,SAASA,OAAO,GAAG;IAElBtB,QAAQ,GAAG,IAAIC,OAAO,EAAE;EAEzB;EAEA,OAAO;IACNI,GAAG,EAAEA,GAAG;IACRiB,OAAO,EAAEA;EACV,CAAC;AAEF;AAEA,SAASxB,aAAa"},"metadata":{},"sourceType":"module","externalDependencies":[]}